<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AddConsultationCommand.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tp</a> &gt; <a href="index.source.html" class="el_package">seedu.address.logic.commands</a> &gt; <span class="el_source">AddConsultationCommand.java</span></div><h1>AddConsultationCommand.java</h1><pre class="source lang-java linenums">package seedu.address.logic.commands;

import static java.util.Objects.requireNonNull;

import java.time.format.DateTimeFormatter;
import java.util.Objects;

import seedu.address.logic.commands.exceptions.CommandException;
import seedu.address.model.Model;
import seedu.address.model.ModelManager;
import seedu.address.model.timeslot.ConsultationTimeslot;
import seedu.address.model.timeslot.Timeslot;

/**
 * Adds a consultation (timeslot associated with a student's name) to the model.
 */
public class AddConsultationCommand extends Command {

    public static final String COMMAND_WORD = &quot;add-consultation&quot;;

    public static final String MESSAGE_USAGE = COMMAND_WORD + &quot;: Adds a consultation timeslot.\n&quot;
            + &quot;Parameters: ts/START_DATETIME te/END_DATETIME n/STUDENT_NAME\n&quot;
            + &quot;Accepted datetime formats: ISO_LOCAL_DATE_TIME or 'd MMM uuuu, HH:mm'\n&quot;
            + &quot;Example: &quot; + COMMAND_WORD + &quot; ts/2025-10-04T10:00:00\n&quot;
            + &quot; te/2025-10-04T11:00:00 n/John Doe&quot;;

    public static final String MESSAGE_SUCCESS = &quot;Added consultation: %1$s with %2$s&quot;;
    public static final String MESSAGE_DUPLICATE_CONSULTATION =
                                &quot;A consultation with the same time and student already exists.&quot;;
    public static final String MESSAGE_DUPLICATE_TIMESLOT = &quot;A timeslot at the same time already exists.&quot;;

    private final ConsultationTimeslot toAdd;

    /**
     * Creates an AddConsultationCommand to add the specified consultation timeslot.
     *
     * @param consultationTimeslot ConsultationTimeslot to add; must not be null.
     */
<span class="fc" id="L39">    public AddConsultationCommand(ConsultationTimeslot consultationTimeslot) {</span>
<span class="fc" id="L40">        requireNonNull(consultationTimeslot);</span>
<span class="fc" id="L41">        this.toAdd = consultationTimeslot;</span>
<span class="fc" id="L42">    }</span>

    @Override
    public CommandResult execute(Model model) throws CommandException {
<span class="fc" id="L46">        requireNonNull(model);</span>

<span class="pc bpc" id="L48" title="1 of 2 branches missed.">        if (!(model instanceof ModelManager)) {</span>
<span class="nc" id="L49">            throw new CommandException(&quot;Model does not support timeslots modification.&quot;);</span>
        }
<span class="fc" id="L51">        ModelManager mm = (ModelManager) model;</span>

        // Reject identical-interval duplicate consultation OR any overlapping timeslot.
<span class="fc bfc" id="L54" title="All 2 branches covered.">        for (Timeslot existing : mm.getTimeslots().getTimeslotList()) {</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">            boolean sameInterval = existing.getStart().equals(toAdd.getStart())</span>
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">                    &amp;&amp; existing.getEnd().equals(toAdd.getEnd());</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">            if (sameInterval) {</span>
<span class="pc bpc" id="L58" title="1 of 2 branches missed.">                if (existing instanceof ConsultationTimeslot) {</span>
<span class="fc" id="L59">                    ConsultationTimeslot c = (ConsultationTimeslot) existing;</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">                    if (toAdd.getStudentName().equals(c.getStudentName())) {</span>
<span class="fc" id="L61">                        throw new CommandException(MESSAGE_DUPLICATE_CONSULTATION);</span>
                    } else {
                        // Another consultation exists at same time with different student -&gt; collision
<span class="fc" id="L64">                        throw new CommandException(MESSAGE_DUPLICATE_TIMESLOT);</span>
                    }
                } else {
                    // Existing generic timeslot at same time -&gt; cannot add consultation
<span class="nc" id="L68">                    throw new CommandException(MESSAGE_DUPLICATE_TIMESLOT);</span>
                }
            }
            // General overlap check: deny any partial/full overlap with existing timeslot
<span class="fc bfc" id="L72" title="All 2 branches covered.">            if (overlaps(existing, toAdd)) {</span>
<span class="fc" id="L73">                throw new CommandException(MESSAGE_DUPLICATE_TIMESLOT);</span>
            }
<span class="fc" id="L75">        }</span>

        // persist previous state for undo
<span class="fc" id="L78">        model.saveAddressBook();</span>

<span class="fc" id="L80">        mm.addTimeslot(toAdd);</span>

<span class="fc" id="L82">        String timeslotStr = String.format(&quot;%s -&gt; %s&quot;,</span>
<span class="fc" id="L83">                toAdd.getStart().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME),</span>
<span class="fc" id="L84">                toAdd.getEnd().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));</span>

<span class="fc" id="L86">        return new CommandResult(String.format(MESSAGE_SUCCESS, timeslotStr, toAdd.getStudentName()));</span>
    }

    /**
     * Two timeslots overlap if their intervals intersect (end &gt; start and start &lt; end).
     */
    private static boolean overlaps(Timeslot a, Timeslot b) {
<span class="pc bpc" id="L93" title="1 of 4 branches missed.">        return a.getEnd().isAfter(b.getStart()) &amp;&amp; a.getStart().isBefore(b.getEnd());</span>
    }

    @Override
    public boolean equals(Object other) {
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">        if (other == this) {</span>
<span class="nc" id="L99">            return true;</span>
        }
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        if (!(other instanceof AddConsultationCommand)) {</span>
<span class="nc" id="L102">            return false;</span>
        }
<span class="fc" id="L104">        AddConsultationCommand o = (AddConsultationCommand) other;</span>
<span class="fc" id="L105">        return Objects.equals(toAdd, o.toAdd);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>